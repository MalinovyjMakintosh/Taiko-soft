from web3 import Web3, Account
import json

rpc_eth = 'https://taiko-grimsvotn-l2.rpc.thirdweb.com'
w3 = Web3(Web3.HTTPProvider(rpc_eth))
w3.eth.account.enable_unaudited_hdwallet_features()
#https://t.me/malinmakin
ERC20_ABI = json.loads('''[{"type":"error","name":"B_CANNOT_RECEIVE","inputs":[]},{"type":"error","name":"B_DENIED","inputs":[]},{"type":"error","name":"B_DENIED","inputs":[]},{"type":"error","name":"B_ERC20_CANNOT_RECEIVE","inputs":[]},{"type":"error","name":"B_ETHER_RELEASED_ALREADY","inputs":[]},{"type":"error","name":"B_ETHER_RELEASED_ALREADY","inputs":[]},{"type":"error","name":"B_EV_DO_NOT_BURN","inputs":[]},{"type":"error","name":"B_EV_NOT_AUTHORIZED","inputs":[]},{"type":"error","name":"B_EV_PARAM","inputs":[]},{"type":"error","name":"B_FAILED_TRANSFER","inputs":[]},{"type":"error","name":"B_FAILED_TRANSFER","inputs":[]},{"type":"error","name":"B_FORBIDDEN","inputs":[]},{"type":"error","name":"B_FORBIDDEN","inputs":[]},{"type":"error","name":"B_GAS_LIMIT","inputs":[]},{"type":"error","name":"B_GAS_LIMIT","inputs":[]},{"type":"error","name":"B_INCORRECT_VALUE","inputs":[]},{"type":"error","name":"B_INCORRECT_VALUE","inputs":[]},{"type":"error","name":"B_INIT_PARAM_ERROR","inputs":[]},{"type":"error","name":"B_MSG_HASH_NULL","inputs":[]},{"type":"error","name":"B_MSG_HASH_NULL","inputs":[]},{"type":"error","name":"B_MSG_NON_RETRIABLE","inputs":[]},{"type":"error","name":"B_MSG_NON_RETRIABLE","inputs":[]},{"type":"error","name":"B_MSG_NOT_FAILED","inputs":[]},{"type":"error","name":"B_MSG_NOT_FAILED","inputs":[]},{"type":"error","name":"B_NULL_APP_ADDR","inputs":[]},{"type":"error","name":"B_OWNER_IS_NULL","inputs":[]},{"type":"error","name":"B_OWNER_IS_NULL","inputs":[]},{"type":"error","name":"B_OWNER_IS_NULL","inputs":[]},{"type":"error","name":"B_SIGNAL_NOT_RECEIVED","inputs":[]},{"type":"error","name":"B_SIGNAL_NOT_RECEIVED","inputs":[]},{"type":"error","name":"B_STATUS_MISMATCH","inputs":[]},{"type":"error","name":"B_STATUS_MISMATCH","inputs":[]},{"type":"error","name":"B_WRONG_CHAIN_ID","inputs":[]},{"type":"error","name":"B_WRONG_CHAIN_ID","inputs":[]},{"type":"error","name":"B_WRONG_CHAIN_ID","inputs":[]},{"type":"error","name":"B_WRONG_CHAIN_ID","inputs":[]},{"type":"error","name":"B_WRONG_CHAIN_ID","inputs":[]},{"type":"error","name":"B_WRONG_TO_ADDRESS","inputs":[]},{"type":"error","name":"B_WRONG_TO_ADDRESS","inputs":[]},{"type":"error","name":"B_ZERO_SIGNAL","inputs":[]},{"type":"error","name":"RESOLVER_DENIED","inputs":[]},{"type":"error","name":"RESOLVER_INVALID_ADDR","inputs":[]},{"type":"error","name":"RESOLVER_ZERO_ADDR","inputs":[{"type":"uint256","name":"chainId","internalType":"uint256"},{"type":"bytes32","name":"name","internalType":"bytes32"}]},{"type":"event","name":"AddressManagerChanged","inputs":[{"type":"address","name":"addressManager","internalType":"address","indexed":false}],"anonymous":false},{"type":"event","name":"DestChainEnabled","inputs":[{"type":"uint256","name":"chainId","internalType":"uint256","indexed":true},{"type":"bool","name":"enabled","internalType":"bool","indexed":false}],"anonymous":false},{"type":"event","name":"EtherReleased","inputs":[{"type":"bytes32","name":"msgHash","internalType":"bytes32","indexed":true},{"type":"address","name":"to","internalType":"address","indexed":false},{"type":"uint256","name":"amount","internalType":"uint256","indexed":false}],"anonymous":false},{"type":"event","name":"EtherReleased","inputs":[{"type":"bytes32","name":"msgHash","internalType":"bytes32","indexed":true},{"type":"address","name":"to","internalType":"address","indexed":false},{"type":"uint256","name":"amount","internalType":"uint256","indexed":false}],"anonymous":false},{"type":"event","name":"Initialized","inputs":[{"type":"uint8","name":"version","internalType":"uint8","indexed":false}],"anonymous":false},{"type":"event","name":"MessageSent","inputs":[{"type":"bytes32","name":"msgHash","internalType":"bytes32","indexed":true},{"type":"tuple","name":"message","internalType":"struct IBridge.Message","indexed":false,"components":[{"type":"uint256","name":"id","internalType":"uint256"},{"type":"address","name":"sender","internalType":"address"},{"type":"uint256","name":"srcChainId","internalType":"uint256"},{"type":"uint256","name":"destChainId","internalType":"uint256"},{"type":"address","name":"owner","internalType":"address"},{"type":"address","name":"to","internalType":"address"},{"type":"address","name":"refundAddress","internalType":"address"},{"type":"uint256","name":"depositValue","internalType":"uint256"},{"type":"uint256","name":"callValue","internalType":"uint256"},{"type":"uint256","name":"processingFee","internalType":"uint256"},{"type":"uint256","name":"gasLimit","internalType":"uint256"},{"type":"bytes","name":"data","internalType":"bytes"},{"type":"string","name":"memo","internalType":"string"}]}],"anonymous":false},{"type":"event","name":"MessageSent","inputs":[{"type":"bytes32","name":"msgHash","internalType":"bytes32","indexed":true},{"type":"tuple","name":"message","internalType":"struct IBridge.Message","indexed":false,"components":[{"type":"uint256","name":"id","internalType":"uint256"},{"type":"address","name":"sender","internalType":"address"},{"type":"uint256","name":"srcChainId","internalType":"uint256"},{"type":"uint256","name":"destChainId","internalType":"uint256"},{"type":"address","name":"owner","internalType":"address"},{"type":"address","name":"to","internalType":"address"},{"type":"address","name":"refundAddress","internalType":"address"},{"type":"uint256","name":"depositValue","internalType":"uint256"},{"type":"uint256","name":"callValue","internalType":"uint256"},{"type":"uint256","name":"processingFee","internalType":"uint256"},{"type":"uint256","name":"gasLimit","internalType":"uint256"},{"type":"bytes","name":"data","internalType":"bytes"},{"type":"string","name":"memo","internalType":"string"}]}],"anonymous":false},{"type":"event","name":"MessageStatusChanged","inputs":[{"type":"bytes32","name":"msgHash","internalType":"bytes32","indexed":true},{"type":"uint8","name":"status","internalType":"enum LibBridgeStatus.MessageStatus","indexed":false},{"type":"address","name":"transactor","internalType":"address","indexed":false}],"anonymous":false},{"type":"event","name":"MessageStatusChanged","inputs":[{"type":"bytes32","name":"msgHash","internalType":"bytes32","indexed":true},{"type":"uint8","name":"status","internalType":"enum LibBridgeStatus.MessageStatus","indexed":false},{"type":"address","name":"transactor","internalType":"address","indexed":false}],"anonymous":false},{"type":"event","name":"OwnershipTransferred","inputs":[{"type":"address","name":"previousOwner","internalType":"address","indexed":true},{"type":"address","name":"newOwner","internalType":"address","indexed":true}],"anonymous":false},{"type":"event","name":"SignalSent","inputs":[{"type":"address","name":"sender","internalType":"address","indexed":false},{"type":"bytes32","name":"msgHash","internalType":"bytes32","indexed":false}],"anonymous":false},{"type":"function","stateMutability":"view","outputs":[{"type":"address","name":"","internalType":"address"}],"name":"addressManager","inputs":[]},{"type":"function","stateMutability":"view","outputs":[{"type":"tuple","name":"","internalType":"struct IBridge.Context","components":[{"type":"bytes32","name":"msgHash","internalType":"bytes32"},{"type":"address","name":"sender","internalType":"address"},{"type":"uint256","name":"srcChainId","internalType":"uint256"}]}],"name":"context","inputs":[]},{"type":"function","stateMutability":"view","outputs":[{"type":"uint8","name":"","internalType":"enum LibBridgeStatus.MessageStatus"}],"name":"getMessageStatus","inputs":[{"type":"bytes32","name":"msgHash","internalType":"bytes32"}]},{"type":"function","stateMutability":"pure","outputs":[{"type":"bytes32","name":"","internalType":"bytes32"}],"name":"getMessageStatusSlot","inputs":[{"type":"bytes32","name":"msgHash","internalType":"bytes32"}]},{"type":"function","stateMutability":"pure","outputs":[{"type":"bytes32","name":"","internalType":"bytes32"}],"name":"hashMessage","inputs":[{"type":"tuple","name":"message","internalType":"struct IBridge.Message","components":[{"type":"uint256","name":"id","internalType":"uint256"},{"type":"address","name":"sender","internalType":"address"},{"type":"uint256","name":"srcChainId","internalType":"uint256"},{"type":"uint256","name":"destChainId","internalType":"uint256"},{"type":"address","name":"owner","internalType":"address"},{"type":"address","name":"to","internalType":"address"},{"type":"address","name":"refundAddress","internalType":"address"},{"type":"uint256","name":"depositValue","internalType":"uint256"},{"type":"uint256","name":"callValue","internalType":"uint256"},{"type":"uint256","name":"processingFee","internalType":"uint256"},{"type":"uint256","name":"gasLimit","internalType":"uint256"},{"type":"bytes","name":"data","internalType":"bytes"},{"type":"string","name":"memo","internalType":"string"}]}]},{"type":"function","stateMutability":"nonpayable","outputs":[],"name":"init","inputs":[{"type":"address","name":"_addressManager","internalType":"address"}]},{"type":"function","stateMutability":"view","outputs":[{"type":"bool","name":"enabled","internalType":"bool"}],"name":"isDestChainEnabled","inputs":[{"type":"uint256","name":"_chainId","internalType":"uint256"}]},{"type":"function","stateMutability":"view","outputs":[{"type":"bool","name":"","internalType":"bool"}],"name":"isEtherReleased","inputs":[{"type":"bytes32","name":"msgHash","internalType":"bytes32"}]},{"type":"function","stateMutability":"view","outputs":[{"type":"bool","name":"","internalType":"bool"}],"name":"isMessageFailed","inputs":[{"type":"bytes32","name":"msgHash","internalType":"bytes32"},{"type":"uint256","name":"destChainId","internalType":"uint256"},{"type":"bytes","name":"proof","internalType":"bytes"}]},{"type":"function","stateMutability":"view","outputs":[{"type":"bool","name":"","internalType":"bool"}],"name":"isMessageReceived","inputs":[{"type":"bytes32","name":"msgHash","internalType":"bytes32"},{"type":"uint256","name":"srcChainId","internalType":"uint256"},{"type":"bytes","name":"proof","internalType":"bytes"}]},{"type":"function","stateMutability":"view","outputs":[{"type":"bool","name":"","internalType":"bool"}],"name":"isMessageSent","inputs":[{"type":"bytes32","name":"msgHash","internalType":"bytes32"}]},{"type":"function","stateMutability":"view","outputs":[{"type":"address","name":"","internalType":"address"}],"name":"owner","inputs":[]},{"type":"function","stateMutability":"nonpayable","outputs":[],"name":"processMessage","inputs":[{"type":"tuple","name":"message","internalType":"struct IBridge.Message","components":[{"type":"uint256","name":"id","internalType":"uint256"},{"type":"address","name":"sender","internalType":"address"},{"type":"uint256","name":"srcChainId","internalType":"uint256"},{"type":"uint256","name":"destChainId","internalType":"uint256"},{"type":"address","name":"owner","internalType":"address"},{"type":"address","name":"to","internalType":"address"},{"type":"address","name":"refundAddress","internalType":"address"},{"type":"uint256","name":"depositValue","internalType":"uint256"},{"type":"uint256","name":"callValue","internalType":"uint256"},{"type":"uint256","name":"processingFee","internalType":"uint256"},{"type":"uint256","name":"gasLimit","internalType":"uint256"},{"type":"bytes","name":"data","internalType":"bytes"},{"type":"string","name":"memo","internalType":"string"}]},{"type":"bytes","name":"proof","internalType":"bytes"}]},{"type":"function","stateMutability":"nonpayable","outputs":[],"name":"releaseEther","inputs":[{"type":"tuple","name":"message","internalType":"struct IBridge.Message","components":[{"type":"uint256","name":"id","internalType":"uint256"},{"type":"address","name":"sender","internalType":"address"},{"type":"uint256","name":"srcChainId","internalType":"uint256"},{"type":"uint256","name":"destChainId","internalType":"uint256"},{"type":"address","name":"owner","internalType":"address"},{"type":"address","name":"to","internalType":"address"},{"type":"address","name":"refundAddress","internalType":"address"},{"type":"uint256","name":"depositValue","internalType":"uint256"},{"type":"uint256","name":"callValue","internalType":"uint256"},{"type":"uint256","name":"processingFee","internalType":"uint256"},{"type":"uint256","name":"gasLimit","internalType":"uint256"},{"type":"bytes","name":"data","internalType":"bytes"},{"type":"string","name":"memo","internalType":"string"}]},{"type":"bytes","name":"proof","internalType":"bytes"}]},{"type":"function","stateMutability":"nonpayable","outputs":[],"name":"renounceOwnership","inputs":[]},{"type":"function","stateMutability":"view","outputs":[{"type":"address","name":"","internalType":"address payable"}],"name":"resolve","inputs":[{"type":"uint256","name":"chainId","internalType":"uint256"},{"type":"bytes32","name":"name","internalType":"bytes32"},{"type":"bool","name":"allowZeroAddress","internalType":"bool"}]},{"type":"function","stateMutability":"view","outputs":[{"type":"address","name":"","internalType":"address payable"}],"name":"resolve","inputs":[{"type":"bytes32","name":"name","internalType":"bytes32"},{"type":"bool","name":"allowZeroAddress","internalType":"bool"}]},{"type":"function","stateMutability":"nonpayable","outputs":[],"name":"retryMessage","inputs":[{"type":"tuple","name":"message","internalType":"struct IBridge.Message","components":[{"type":"uint256","name":"id","internalType":"uint256"},{"type":"address","name":"sender","internalType":"address"},{"type":"uint256","name":"srcChainId","internalType":"uint256"},{"type":"uint256","name":"destChainId","internalType":"uint256"},{"type":"address","name":"owner","internalType":"address"},{"type":"address","name":"to","internalType":"address"},{"type":"address","name":"refundAddress","internalType":"address"},{"type":"uint256","name":"depositValue","internalType":"uint256"},{"type":"uint256","name":"callValue","internalType":"uint256"},{"type":"uint256","name":"processingFee","internalType":"uint256"},{"type":"uint256","name":"gasLimit","internalType":"uint256"},{"type":"bytes","name":"data","internalType":"bytes"},{"type":"string","name":"memo","internalType":"string"}]},{"type":"bool","name":"isLastAttempt","internalType":"bool"}]},{"type":"function","stateMutability":"payable","outputs":[{"type":"bytes32","name":"msgHash","internalType":"bytes32"}],"name":"sendMessage","inputs":[{"type":"tuple","name":"message","internalType":"struct IBridge.Message","components":[{"type":"uint256","name":"id","internalType":"uint256"},{"type":"address","name":"sender","internalType":"address"},{"type":"uint256","name":"srcChainId","internalType":"uint256"},{"type":"uint256","name":"destChainId","internalType":"uint256"},{"type":"address","name":"owner","internalType":"address"},{"type":"address","name":"to","internalType":"address"},{"type":"address","name":"refundAddress","internalType":"address"},{"type":"uint256","name":"depositValue","internalType":"uint256"},{"type":"uint256","name":"callValue","internalType":"uint256"},{"type":"uint256","name":"processingFee","internalType":"uint256"},{"type":"uint256","name":"gasLimit","internalType":"uint256"},{"type":"bytes","name":"data","internalType":"bytes"},{"type":"string","name":"memo","internalType":"string"}]}]},{"type":"function","stateMutability":"nonpayable","outputs":[],"name":"setAddressManager","inputs":[{"type":"address","name":"newAddressManager","internalType":"address"}]},{"type":"function","stateMutability":"nonpayable","outputs":[],"name":"transferOwnership","inputs":[{"type":"address","name":"newOwner","internalType":"address"}]},{"type":"receive","stateMutability":"payable"}]''')
#https://t.me/malinmakin
eth_contract_addressd = '0x21561e1c1c64e18aB02654F365F3b0f7509d9481'
eth_contract_address = Web3.to_checksum_address(eth_contract_addressd)
#https://t.me/malinmakin
#https://t.me/malinmakin
eth_contract = w3.eth.contract(eth_contract_address, abi=ERC20_ABI)

txt = 'privates.txt'
with open(txt, 'r', encoding = 'utf-8') as keys_file:
    accounts = [Account.from_key(line.replace("\n", "")) for line in keys_file.readlines()]


CHAIN_ID = w3.eth.chain_id
GAS_AMOUNT = 117238
value = 4350000000900000


def change_contract_state(account):
    address = account.address
    test = tuple([1, address, 167005, 167006, address, address, address, 3000000000000000, 0, 1350000000900000, 140000, '0x', ''])
    nonce = w3.eth.get_transaction_count(address)

    transaction = eth_contract.functions.sendMessage(test).build_transaction({
        'chainId': CHAIN_ID,
        'gas': GAS_AMOUNT,
        'gasPrice': w3.eth.gas_price,
        'from': address,
        'nonce': nonce,
        'value': value
    })
    signed_txn = w3.eth.account.sign_transaction(transaction, private_key=account.key)
    txn = w3.eth.send_raw_transaction(signed_txn.rawTransaction)
    return txn


txt = 'privates.txt'
with open(txt, 'r', encoding = 'utf-8') as keys_file:
    accounts = [Account.from_key(line.replace("\n", "")) for line in keys_file.readlines()]
    for account in accounts:
        txn = change_contract_state(account)
        print(f'https://sepolia.etherscan.io/tx/{txn.hex()}')


